# TPack Diagnostic

Tool for diagnosing Terraria Resource Packs.

Note that this is largely intended for overhaul packs.
Smaller Resource Packs don't really need external tools to keep things
manageable.

## Current Reference File Versions

The reference files hold their format versions.
If the versions do not match the numbers in the table below, the files are out
of date and you will need to run the `gen` command again.

- The `.slop` files have a keyvalue whose key is `!version` and value is
  the version.
- The `.txt` files currently do not have a stored version.

| File           | Version | Changed In |
|:--------------:|:-------:|:----------:|
| `images.slop`  | `1`     | `2.0.0`    |
| `sounds.slop`  | `0`     | `2.0.0`    |
| `music.txt`    | *N/A*   | `2.0.0`    |
| `loc_keys.txt` | *N/A*   | `1.0.0`    |

## Installation

Before installing this tool, you should first get the extracted game assets.

1. Get [TConvert] and use it to extract the assets.
   Make sure the `Images`, `Sounds` and `Wave Bank` options are all checked
   before extracting.

   ![the images, sounds and wave bank options, checked](.github/tconvert_checkboxes.png)
2. Download the [All Localizations.csv] file. Save it as `Loc.csv` inside the
   folder holding the data extracted by TConvert.

Now we can move on to setting up TPack Diagnostic

### If you are on Windows

1. On the [latest release], download the attached `.exe` file.

### If you are *not* on Windows (sorry)

1. Make sure you have the latest versions of [Rust](https://www.rust-lang.org/)
   and [Git](https://git-scm.com/).
2. Clone this repo.
3. Move the command line to its root dir and run:

   ```bash
   cargo build --release
   ```

4. There should now be an `.exe` file under `target/release/`.

## Usage

Syntax:

```bash
t_pack_diagnostic <ACTION> [args]
```

- `<ACTION>`: One of a set of strings. (see below)
  Each action has its own set of arguments.
- `[args]`: An actions arguments. Possible arguments are:
  - `--input` (`-i`)
  - `--output` (`-o`)
  - `--reference` (`-r`)

Run with `--help` (`-h`) instead for a quick help string, or `--version` (`-V`)
to check the binary's current version:

```bash
t_pack_diagnostic --help
```

```bash
t_pack_diagnostic --version
```

## Actions

### Generate - `gen`

```bash
t_pack_diagnostic gen -i ... -o ...
```

Generates a set of reference files from extracted game assets.

The "extracted game assets" are assumed to be sprite, sound and wave bank
assets extracted with [TConvert], plus a file called `Loc.csv` containing all
of the game's translations.

| Arg  | Desc                               |
|------|------------------------------------|
| `-i` | Root dir of extracted files.       |
| `-o` | Dir for helpers to be dumped into. |

### Scan - `scan`

```bash
t_pack_diagnostic scan -i ... -r ...
```

Scans your Resource Pack and gives a diagnostic of it.

Currently only scans images and localization.

#### Notes about scanning localization files

As of writing, the scanner can only read CSV files,
can't tell different languages apart, and can't notice duplicate entries.

Also, entries where the first character of the first field is `#` are ignored.

| Arg  | Desc                                   |
|------|----------------------------------------|
| `-i` | Root dir of your Resource Pack.        |
| `-r` | Dir of the helpers generated by `gen`. |

### Build - `build`

```bash
t_pack_diagnostic build -i ... -o ... -r ...
```

Creates a copy of your Resource Pack with only valid files,
preparing it for uploading.

Currently does not properly validate localization files.

| Arg  | Desc                                   |
|------|----------------------------------------|
| `-i` | Root dir of your Resource Pack.        |
| `-o` | Root dir of the copy.                  |
| `-r` | Dir of the helpers generated by `gen`. |

<!-- References -->

[All Localizations.csv]: https://forums.terraria.org/index.php?attachments/all-localizations-csv.391802/
[latest release]: https://github.com/ThEnderYoshi/t-pack-diagnostic/releases/latest
[TConvert]: https://github.com/trigger-segfault/TConvert
